<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Teste WhatsApp QR Code - Hospedagem</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            color: #25D366;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
        }
        .success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .info {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        .warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        .button {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        .button:hover {
            background: linear-gradient(135deg, #128C7E, #075E54);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #666;
        }
        .qr-container {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .qr-container img {
            max-width: 300px;
            border: 3px solid #25D366;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .instructions {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #25D366;
        }
        .instructions h3 {
            color: #25D366;
            margin-top: 0;
        }
        .instructions ol {
            padding-left: 20px;
        }
        .instructions li {
            margin: 10px 0;
            line-height: 1.6;
        }
        .config-info {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2196F3;
        }
        .config-info h3 {
            color: #1976D2;
            margin-top: 0;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .button-group {
            text-align: center;
            margin: 20px 0;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Teste WhatsApp QR Code</h1>
        
        <div class="config-info">
            <h3>üìã Configura√ß√£o:</h3>
            <p><strong>URL da API:</strong> <span id="api-url">https://whatsapp-api-ultra-simple.vercel.app</span></p>
            <p><strong>Dom√≠nio:</strong> <span id="domain">startzap.comporhub.com</span></p>
            <p><strong>Status:</strong> <span id="connection-status">Verificando...</span></p>
        </div>
        
        <div id="status" class="status info">
            ‚è≥ Aguardando teste...
        </div>

        <div class="button-group">
            <button class="button" onclick="testarConexao()">üîç Testar Conex√£o</button>
            <button class="button" onclick="gerarQR()">üì± Gerar QR Code</button>
            <button class="button" onclick="limparLog()">üóëÔ∏è Limpar Log</button>
        </div>

        <div id="loading" class="loading" style="display: none;">
            ‚è≥ Carregando...
        </div>

        <div id="qrContainer" class="qr-container" style="display: none;">
            <h3 style="color: #333; margin-bottom: 20px;">üì± Escaneie este QR Code</h3>
            <img id="qrImage" src="" alt="QR Code WhatsApp">
            <p style="color: #666; margin-top: 15px;">
                <strong>Sess√£o:</strong> <span id="sessionId"></span>
            </p>
            <p style="color: #999; font-size: 14px;">
                QR Code expira em 5 minutos
            </p>
        </div>

        <div class="instructions">
            <h3>üìã Como Conectar:</h3>
            <ol>
                <li><strong>Teste a Conex√£o:</strong> Clique em "Testar Conex√£o" para verificar se a API est√° funcionando</li>
                <li><strong>Gere o QR Code:</strong> Clique em "Gerar QR Code"</li>
                <li><strong>Abra o WhatsApp:</strong> No seu celular, abra o WhatsApp</li>
                <li><strong>Acesse Aparelhos Conectados:</strong> V√° em Configura√ß√µes ‚Üí Aparelhos conectados</li>
                <li><strong>Conecte um Aparelho:</strong> Toque em "Conectar um aparelho"</li>
                <li><strong>Escaneie o QR:</strong> Use a c√¢mera para escanear o QR code que apareceu acima</li>
                <li><strong>Aguarde:</strong> O WhatsApp ser√° conectado automaticamente</li>
            </ol>
        </div>

        <div id="log" class="log"></div>

        <div class="footer">
            <p>üîß P√°gina de teste independente - Funciona sem rotas Laravel</p>
            <p>üìÖ Gerado em: <span id="timestamp"></span></p>
        </div>
    </div>

    <script>
        // Configura√ß√£o da API
        const API_URL = 'https://whatsapp-api-ultra-simple.vercel.app';
        let currentSessionId = null;

        // Fun√ß√£o para log
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            };
            
            logElement.textContent += `[${timestamp}] ${typeIcon[type] || '‚ÑπÔ∏è'} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Fun√ß√£o para atualizar status
        function setStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        // Fun√ß√£o para mostrar/esconder loading
        function showLoading(show, message = '‚è≥ Carregando...') {
            const loading = document.getElementById('loading');
            if (show) {
                loading.style.display = 'block';
                loading.textContent = message;
            } else {
                loading.style.display = 'none';
            }
        }

        // Fun√ß√£o para limpar log
        function limparLog() {
            document.getElementById('log').textContent = '';
            log('Log limpo', 'info');
        }

        // Fun√ß√£o para testar conex√£o
        async function testarConexao() {
            log('üîÑ Iniciando teste de conex√£o...', 'info');
            setStatus('üîÑ Testando conex√£o com a API...', 'info');
            showLoading(true, '‚è≥ Testando conex√£o...');
            
            try {
                const response = await fetch(`${API_URL}/api`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                showLoading(false);
                log(`üì° Status da resposta: ${response.status}`, 'info');

                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ API funcionando! Vers√£o: ${data.version}`, 'success');
                    setStatus('‚úÖ Conex√£o com a API estabelecida com sucesso!', 'success');
                    document.getElementById('connection-status').textContent = 'Conectado ‚úÖ';
                    
                    // Mostrar endpoints dispon√≠veis
                    if (data.available_endpoints) {
                        log('üìã Endpoints dispon√≠veis:', 'info');
                        data.available_endpoints.forEach(endpoint => {
                            log(`   ‚Ä¢ ${endpoint}`, 'info');
                        });
                    }
                } else {
                    log(`‚ùå Erro na API: ${response.status} - ${response.statusText}`, 'error');
                    setStatus(`‚ùå Erro na API: ${response.status}`, 'error');
                    document.getElementById('connection-status').textContent = 'Erro ‚ùå';
                }
            } catch (error) {
                showLoading(false);
                log(`üí• Erro de conex√£o: ${error.message}`, 'error');
                setStatus(`üí• Erro de conex√£o: ${error.message}`, 'error');
                document.getElementById('connection-status').textContent = 'Desconectado ‚ùå';
                
                if (error.message.includes('CORS')) {
                    log('üö® PROBLEMA DE CORS DETECTADO!', 'error');
                    log('üí° Solu√ß√£o: Verificar configura√ß√£o CORS da API', 'warning');
                }
            }
        }

        // Fun√ß√£o para gerar QR Code
        async function gerarQR() {
            log('üì± Iniciando gera√ß√£o de QR Code...', 'info');
            setStatus('üì± Gerando QR Code...', 'info');
            showLoading(true, '‚è≥ Gerando QR Code...');
            
            const qrContainer = document.getElementById('qrContainer');
            const qrImage = document.getElementById('qrImage');
            const sessionIdSpan = document.getElementById('sessionId');
            
            // Esconder QR anterior
            qrContainer.style.display = 'none';
            
            try {
                const response = await fetch(`${API_URL}/api/test/qr`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                showLoading(false);
                log(`üì° Status da resposta QR: ${response.status}`, 'info');

                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ QR Code recebido: ${data.message}`, 'success');
                    
                    if (data.data && data.data.qrCode) {
                        currentSessionId = data.data.sessionId;
                        
                        // Mostrar QR code
                        qrImage.src = data.data.qrCode;
                        sessionIdSpan.textContent = currentSessionId;
                        qrContainer.style.display = 'block';
                        
                        setStatus('‚úÖ QR Code gerado com sucesso! Escaneie com seu WhatsApp.', 'success');
                        log(`üì± Session ID: ${currentSessionId}`, 'success');
                        log(`‚è∞ QR Code expira em: ${data.data.expiresIn} segundos`, 'warning');
                        
                        // Auto-refresh do QR code em 4 minutos
                        setTimeout(() => {
                            log('üîÑ QR Code expirando em 1 minuto...', 'warning');
                            setStatus('‚ö†Ô∏è QR Code expirando em breve. Clique em "Gerar QR Code" para renovar.', 'warning');
                        }, 240000); // 4 minutos
                        
                    } else {
                        log('‚ùå QR Code n√£o encontrado na resposta', 'error');
                        setStatus('‚ùå Erro: QR Code n√£o encontrado na resposta', 'error');
                    }
                } else {
                    const errorText = await response.text();
                    log(`‚ùå Erro ao gerar QR: ${response.status} - ${errorText}`, 'error');
                    setStatus(`‚ùå Erro ao gerar QR: ${response.status}`, 'error');
                }
            } catch (error) {
                showLoading(false);
                log(`üí• Erro ao gerar QR: ${error.message}`, 'error');
                setStatus(`üí• Erro ao gerar QR: ${error.message}`, 'error');
            }
        }

        // Inicializa√ß√£o da p√°gina
        window.addEventListener('load', function() {
            // Mostrar timestamp
            document.getElementById('timestamp').textContent = new Date().toLocaleString('pt-BR');
            
            // Log inicial
            log('üöÄ P√°gina de teste carregada', 'success');
            log(`üåê API URL: ${API_URL}`, 'info');
            log('üí° Esta p√°gina funciona independente das rotas Laravel', 'info');
            
            // Teste autom√°tico de conex√£o
            setTimeout(() => {
                log('üîÑ Iniciando teste autom√°tico de conex√£o...', 'info');
                testarConexao();
            }, 1000);
        });

        // Detectar se est√° sendo executado na hospedagem
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            document.getElementById('domain').textContent = window.location.hostname;
        }
    </script>
</body>
</html>